<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>RSS Project</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/vendor/normalize.css">
    <link rel="stylesheet" href="css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="css/vendor/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/modernizr-2.6.2.min.js"></script>
    <script src="js/vendor/jquery-1.9.1.min.js"></script>
    <script src="js/vendor/tagCanvas.js" type="text/javascript"></script>
    <script type="text/javascript">
          $(document).ready(function() {
          if(!$('#myCanvas').tagcanvas({
            textColour: '#000000',
            outlineColour: '#ff00ff',
            reverse: true,
            depth: 0.8,
            maxSpeed: 0.05
          },'tags')) {
            $('#myCanvasContainer').hide();
          }
          });
    </script>

    <style type="text/css">
      #maprow {
        margin-bottom: 2em;
      }
      #map-canvas {
        min-height: 200px;
      }
    </style>
  </head>

  <body>
    <div class="navbar navbar-inverse">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">RSS Project</a>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row" id="maprow">
        <div class="span12">
          <div id="map-canvas"> </div>
        </div>
      </div>

      <div class="row">
        <div class="span2" id="sources">
          <h3>Sources</h3>
        </div>

        <div class="span6" id="articles">
          <h3>Headlines</h3>
          <div id="feed" class="sidebar"> </div>
        </div>

        <div class="span4" id="tagcloud">
          <h3>Keywords</h3>
		  <div id="myCanvasCont">
			<canvas width="300" height="300" id="myCanvas">
			</canvas>
		  </div>

		  <div id="tags">
			  <ul>
				<li><a href="http://www.google.com" target="_blank">Google</a></li>
				<li><a href="http://www.cnn.com" target="_blank">CNN</a></li>
				<li><a href="http://www.bbc.co.uk" target="_blank">BBC</a></li>
				<li><a href="http://www.reuters.com"target="_blank">Reuters</a></li>
			  </ul>
		  </div>
		</div>


      </div>



      <!-- Javascript files at the end -->
      <script src="js/vendor/bootstrap.min.js"></script>
      <script src="js/vendor/underscore-min.js"></script>
      <script src="js/vendor/mustache.js"></script>
      <script src="js/plugins.js"></script>
      <script src="data/articles.js"></script>
      <script src="js/main.js"></script>
      <script type="text/javascript" src="https://www.google.com/jsapi"></script>
      <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
      <script type="text/javascript">
        var citiesToArticles = new Array();

        var geocoder = new google.maps.Geocoder();
        google.maps.visualRefresh = true;

        function update() {
            _.each(currentArticles,function(entry) {
              extractCities(entry.cities.join(' '));
            });

          $('#feed').html(renderHeadlines({entries: currentArticles}));
        }

        function initializeMap() {
          var latlng = new google.maps.LatLng(-34.397, 150.644);
          var mapOptions = {
              zoom: 8,
              center: latlng,
              mapTypeId: google.maps.MapTypeId.ROADMAP
          }
          map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        }

        function codeAddress(address) {
          geocoder.geocode( { 'address': address}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              map.setCenter(results[0].geometry.location);
              var marker = new google.maps.Marker({
                  map: map,
                  position: results[0].geometry.location
              });
            } else {
              alert('Geocode was not successful for the following reason: ' + status);
            }
          });
        }

        function extractCities(inputText) {
          var cities = ["Barcelona", "Israel", "New York", "Jerusalem", "Miami", "Atlanta"];
          for (var i = 0; i < cities.length; i++) {
            if (inputText.indexOf(cities[i]) != -1) {
              var tempArray = [inputText, cities[i]];
              citiesToArticles.push(tempArray);
              codeAddress(cities[i]);
            }
          }
        }

        google.setOnLoadCallback(update);
        google.maps.event.addDomListener(window, 'load', initializeMap);
      </script>
    </div>
  </body>
</html>
